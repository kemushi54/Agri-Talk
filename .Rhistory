#-- load library
library(rvest)
library(magrittr)
library(data.table)
#--
pest.info <-
html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E8%9F%B2%E5%AE%B3.htm")
#--
pest.info <-
read_html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E8%9F%B2%E5%AE%B3.htm")
pest.info %>%
html_node("td") %>%
html_text()
pest.info %>%
html_node("tr") %>%
html_text() %>%
as.numeric()
pest.info %>%
html_node("tr") %>%
html_text()
pest.info %>%
html_node("a") %>%
html_text()
pest.info %>%
html_node("td a") %>%
html_text()
pest.info %>%
html_node("center div a") %>%
html_text()
pest.info %>%
html_node("center > table table td:nth-child(1) font , center div a") %>%
html_text()
pest.info %>%
html_node("a.href") %>%
html_text()
pest.info %>%
html_node("a") %>%
html_text()
pest.info %>%
html_node("a") %>%
html_attrs()
pest.info %>%
html_node("a") %>%
html_attrs("href")
a <- pest.info %>%
html_node("a") %>%
html_attrs()
a
a <- pest.info %>%
html_node("td font a") %>%
html_attrs()
a
a <- pest.info %>%
html_node("td font a") %>%
html_text()
a <- pest.info %>%
html_node("table") %>%
html_text()
a <- pest.info %>%
html_node("#table3") %>%
html_text()
a <- pest.info %>%
html_node("#table3") %>%
html_table()
a <- pest.info %>%
html_node("#table3 span") %>%
html_table()
a <- pest.info %>%
html_node("#table3 span") %>%
html_text()
a <- pest.info %>%
html_node("table#table3 span") %>%
html_text()
a <- pest.info %>%
html_node("table#table3 span") %>%
html_table()
a <- pest.info %>%
html_node("table#table3 span") %>%
html_text()
a
a <- pest.info %>%
html_nodes("table#table3 span") %>%
html_text()
a <- pest.info %>%
html_nodes("table#table3 span") %>%
html_table()
a <- pest.info %>%
html_nodes(xpath = "//*[@id="table3"]") %>%
html_table()
a <- pest.info %>%
html_nodes(xpath = '//*[@id="table3"]') %>%
html_table()
a
#--
pest.info <-
read_html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9E%9F.htm")
a <- pest.info %>%
html_nodes(xpath = '//*[@id="table3"]') %>%
html_table()
#--
pest.info <-
read_html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9E%9F.htm")
#--
pest.info <-
html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9E%9F.htm")
a <- pest.info %>%
html_nodes(xpath = '//*[@id="table3"]') %>%
html_table()
#--
pest.info <-
html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9E%9F.htm")
#--
pest.info <-
read_html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9E%9F.htm")
#--
pest.info <-
read_html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9A%9C.htm")
a <- pest.info %>%
html_nodes(xpath = '//*[@id="table3"]') %>%
html_table()
a <- pest.info %>%
html_nodes("#table2") %>%
html_table()
#--
pest.info <-
read_html("http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9A%9C.htm")
a <- pest.info %>%
html_nodes("#table2")
a
View(a)
xpath <- '//*[@id="table2"]'
a <- xml_find_all(pest.info, xpath)
xml_text(a)
library(stringr)
a <-
xml_find_all(pest.info, xpath) %>%
str_remove(pattern = "\\s")
a
a <-
xml_find_all(pest.info, xpath)
xml_text(a) %>%
str_remove(pattern = "\\s")
?str_remove
xml_text(a) %>%
str_replace(pattern = "\\s", "")
xml_text(a) %>%
str_replace("\\s")
xml_text(a) %>%
str_replace("\\s", "")
xml_text(a) %>%
str_replace("\\W", "")
xml_text(a)
xml_text(a) %>%
str_replace("\\W", "")
?substr
?substring
str_replace("aaabb\t", "\\s", "11")
str_replace("aaabb\t", "\\s", "1")
str_replace("aaabb\t\n\r\t", "\\s", "1")
xml_text(a) %>%
str_replace_all("\\s", "")
xml_text(a) %>%
str_replace_all("\\s", "_")
xml_text(a) %>%
str_replace_all("\\s", "_") %>%
str_split(pattern = "_")
xml_text(a) %>%
str_replace_all("\\s", "_") %>%
str_split(pattern = "_") %>%
do.call(rbind, .)
xml_text(a) %>%
str_replace_all("\\s", "_") %>%
str_split(pattern = "_") %>%
.[. != ""]
pest.text <-
xml_text(a) %>%
str_replace_all("\\s", "_") %>%
str_split(pattern = "_")
pest.text <-
xml_text(a) %>%
str_replace_all("\\s", "_") %>%
str_split(pattern = "_") %>%
unlist
text.clean <-
pest.text[pest.text != ""]
text.clean
#--
# for url
url.1 <- "http://web.tari.gov.tw/techcd/%E8%94%AC%E8%8F%9C/%E6%9E%9C%E8%8F%9C%E9%A1%9E/%E7%8E%89%E7%B1%B3/%E8%9F%B2%E5%AE%B3/%E7%8E%89%E7%B1%B3-%E7%8E%89%E7%B1%B3%E8%9A%9C.htm"
xpath <-  '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]'
a <-
xml_find_all(pest.info, xpath)
a <-
xml_find_all(pest.info, xpath) %>%
xml_attr("href")
content <-
xml_find_all(all.url, xpath) %>%
xml_text
all.url <-
read_html(url)
xpath <-  '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]'
content <-
xml_find_all(all.url, xpath) %>%
xml_text
all.url <-
read_html(url)
all.url <-
read_html(url.1)
xpath <-  '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]'
content <-
xml_find_all(all.url, xpath) %>%
xml_text
content <-
xml_find_all(all.url, xpath) %>%
xml_attr("href")
content <-
xml_find_all(all.url, xpath) %>%
xml_text
xpath <- '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]'
content <-
xml_find_all(all.url, xpath) %>%
xml_text
content <-
xml_find_all(all.url, "td p a") %>%
xml_text
xpath <- '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]/p[2]/font/a'
content <-
xml_find_all(all.url, "td p a") %>%
xml_text
content <-
xml_find_all(all.url, xpath) %>%
xml_text
xpath <- '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]/font'
content <-
xml_find_all(all.url, xpath) %>%
xml_text
all.url <-
read_html(url.1)
xpath <- '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]/font'
content <-
xml_find_all(all.url, xpath) %>%
xml_text
xpath <- '/html/body/table[2]/tbody/tr[2]/td[2]/div[2]/center/table/tbody/tr/td/div/table/tbody/tr/td[1]'
content <-
xml_find_all(all.url, xpath) %>%
xml_text
content <-
xml_find_all(all.url, xpath)
xpath <- '/html/body/table[2]/'
content <-
xml_find_all(all.url, xpath)
content <-
html_nodes(all.url, "tr td font a") %>%
xml_text
content
content <-
html_nodes(all.url, "tbody tr td font a") %>%
xml_text
content <-
html_nodes(all.url, "tr td font a") %>%
xml_text
content <-
html_nodes(all.url, "table tbody tr td font a") %>%
xml_text
content <-
html_nodes(all.url, "div table tbody tr td font a") %>%
xml_text
content <-
html_nodes(all.url, "tr td font a") %>%
xml_text
content
content <-
html_nodes(all.url, "tr td font") %>%
xml_text
content
installed.packages("rvest")
install.packages("XML")
install.packages("RCurl")
#-- load library
library(rvest)
library(magrittr)
library(data.table)
library(XML)
library(RCurl)
url <- sprintf("http://210.69.150.201/InsectTest/Search.asp?pageNo=%s&keyWord=&CropInum=10268",
1:3)
t <-
getURL(url[1])
t2 <- readHTMLTable(t,
stringsAsFactors = FALSE)
# //*[@id="table32"]/tbody/tr[3]/td/table
test <- read_html(url[1])
# //*[@id="table32"]/tbody/tr[3]/td/table
xpath = '//*[@id="table32"]/tbody/tr[3]/td/table'
test <- read_html(url[1]) %>%
html_nodes(xpath = xpath)
url[1]
test <- read_html(url[1]) %>%
html_nodes("tr td")
test <- read_html(url[1]) %>%
html_nodes("tr td") %>%
html_text
test <- read_html(url[1]) %>%
html_nodes("tr td") %>%
html_table
test[1:10]
test[1]
test[2]
?html_nodes
# //*[@id="table32"]/tbody/tr[3]/td/table
xpath = '//*[@id="table32"]'
test <- read_html(url[1]) %>%
html_nodes(xpath = xpath) %>%
html_table
test <- read_html(url[1]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE)
View(test)
View(test[[1]])
install.packages("writexl")
library(writexl)
write_xlsx(test, "pest_checklist.xlsx")
test <- read_html(url[2]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE)
test <- read_html(url[2]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE) %>%
unlist
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE)) %>%
do.call(rbind, .)
checklist <-
lapply(1:length(url),
function(x)
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE)) %>%
do.call(rbind, .)
View(checklist)
View(checklist[[1]])
View(checklist[[2]])
View(checklist[[3]])
dim(checklist[[3]])
dim(checklist[[2]])
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE)) %>%
do.call(rbind, .) %>%
write_xlsx("pest_checklist.xlsx")
checklist <-
lapply(1:length(url),
function(x)
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE)) %>%
do.call(rbind, .) %>%
write_xlsx("pest_checklist.xlsx")
checklist <-
lapply(1:length(url),
function(x)
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE) %>%
as.data.table(.[[1]]))
class(checklist[[1]])
View(checklist[[1]])
checklist <-
lapply(1:length(url),
function(x)
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE) %>%
as.data.table(.[[1]]) %>%
.[5:55, 1:6])
head(checklist[[1]])
checklist <-
lapply(1:length(url),
function(x)
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE) %>%
as.data.table(.[[1]]) %>%
.[5:55, 1:6]) %>%
do.call(rbind, .)
checklist <-
lapply(1:length(url),
function(x)
read_html(url[x]) %>%
html_nodes(xpath = xpath) %>%
html_table(fill = TRUE) %>%
as.data.table(.[[1]]) %>%
.[5:55, 1:6]) %>%
do.call(rbind, .) %>%
write_xlsx("pest_checklist.xlsx")
